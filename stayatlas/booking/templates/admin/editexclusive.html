<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Villa Details</title>
        <!-- <link rel="stylesheet" href="admin.css"> -->
    </head>
    <body>
        <style>
            
    /* General Styles */
    body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f7fc;
    color: #333;
    display: flex;
    flex-direction: row;
    min-height: 100vh;
}
/* General Page Styling */
body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(to right, #ddeedf, #ffffff);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

/* Form Container */
.container {
    background: #ffffff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    width: 400px;
    text-align: center;
}
.container-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    width: 100%;
    padding: 20px; /* Ensures top part is never clipped */
    box-sizing: border-box;
    margin-top: 100px;
}

/* Form Header */
h2 {
    color: #2c786c;
    margin-bottom: 20px;
}

/* Form Labels */
label {
    display: block;
    text-align: left;
    margin-top: 10px;
    font-weight: bold;
    color: #333;
}

/* Form Inputs and Textarea */
input, textarea {
    width: 90%;
    padding: 10px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
    outline: none;
}

input:focus, textarea:focus {
    border-color: #2c786c;
    box-shadow: 0 0 5px rgba(44, 120, 108, 0.5);
}

/* Submit and Cancel Buttons */
button {
    background: #2c786c;
    color: white;
    padding: 10px;
    border: none;
    width: 100%;
    cursor: pointer;
    font-size: 16px;
    border-radius: 5px;
    margin-top: 15px;
    transition: 0.3s;
}

.save-btn:hover {
    background: #1b5d4f;
}
.cancel-btn:hover {
    background: #ff1111;
}

/* Cancel Button */
button[onclick] {
    background: #d9534f;
}

button[onclick]:hover {
    background: #c9302c;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    text-align: center;
}

/* Modal Content */
.modal-content {
    margin: 5% auto;
    display: block;
    width: 70%;
    max-width: 600px;
    border-radius: 10px;
}

/* Close Button */
.close {
    position: absolute;
    top: 15px;
    right: 25px;
    color: white;
    font-size: 30px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #ccc;
}

/* Navigation Buttons */
.prev, .next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 30px;
    font-weight: bold;
    color: white;
    cursor: pointer;
    padding: 10px;
}

.prev {
    left: 10px;
}

.next {
    right: 10px;
}

.prev:hover, .next:hover {
    color: #ccc;
}


.photo-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.photo-container {
    position: relative;
    display: inline-block;
}

.existing-image {
    width: 120px;
    height: 100px;
    border-radius: 5px;
    object-fit: cover;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
}

.delete-photo-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
    font-size: 14px;
    line-height: 25px;
    text-align: center;
    display: none;
}

.photo-container:hover .delete-photo-btn {
    display: block;
}

.delete-photo-btn:hover {
    background: rgba(255, 0, 0, 0.9);
}



@media (min-width: 320px) {
    .container-wrapper {
        margin-top: 250%;
    }

    h1 {
        font-size: 20px; /* Make title smaller */
    }

    table td {
        font-size: 13px; /* Adjust text size */
        padding: 6px;
    }

    img {
        max-width: 230px; /* Ensure image fits */
    }

    .back-btn {
        font-size: 12px;
        padding: 8px;
    }
    
}
@media (max-width: 375px) {
    .container{
    margin-top: 350px;
}
.container-wrapper {
        margin-top: 200%;
    }
}

@media (min-width: 425px) {
    .container {
        width: 85%;  /* Reduce width */
        padding: 15px; /* Less padding */
        margin-top: 280px;
    }
    .container-wrapper {
        margin-top: 200%;
    }

    h1 {
        font-size: 40px; /* Make title smaller */
    }

    table td {
        font-size: 15px; /* Adjust text size */
        padding: 6px;
    }

    img {
        max-width: 300px; /* Ensure image fits */
    }

    .back-btn {
        font-size: 12px;
        padding: 8px;
    }
}
@media (min-width: 768px) {
    .container{
    margin-top: 350px;
}
.container-wrapper {
        margin-top: 50%;
    }
}

@media (min-width: 1024px) {
    .container{
    margin-top: 350px;
}
.container-wrapper {
        margin-top: 30%;
    }
}
@media (min-width: 1440px) {
    .container{
    margin-top: 350px;
}
.container-wrapper {
        margin-top: 0%;
    }
}


    </style>
    <div class="container-wrapper">
        <div class="container">
            <form method="POST" enctype="multipart/form-data" data-redirect="{% url 'exclusivebookings' %}">
                {% csrf_token %}
        
                <label for="title">Title:</label>
                <input type="text" name="title" value="{{ booking.title }}" required readonly><br>
        
                <label for="first_name">First Name:</label>
                <input type="text" name="first_name" value="{{ booking.first_name }}" required readonly><br>
        
                <label for="last_name">Last Name:</label>
                <input type="text" name="last_name" value="{{ booking.last_name }}" required readonly><br>
        
                <label for="email">Email:</label>
                <input type="email" name="email" value="{{ booking.email }}" required readonly><br>
        
                <label for="mobile">Mobile:</label>
                <input type="text" name="mobile" value="{{ booking.mobile }}" required readonly><br>
        
                <label for="location">Location:</label>
                <input type="text" name="location" value="{{ booking.location }}" required readonly><br>
        
                <label for="property_type">Property Type:</label>
                <input type="text" name="property_type" value="{{ booking.property_type }}" required readonly><br>
        
                <label for="rooms">Rooms:</label>
                <input type="number" name="rooms" value="{{ booking.rooms }}" required readonly><br>
        
                <label for="beds">Beds:</label>
                <input type="number" name="beds" value="{{ booking.beds }}" required readonly><br>
        
                <label for="bath">Bath:</label>
                <input type="number" name="bath" value="{{ booking.bath }}" required readonly><br>
        
                <label for="price">Price:</label>
                <input type="number" name="price" value="{{ booking.price }}" required readonly><br>
        
                <label for="description">Description:</label>
                <textarea name="description" required readonly>{{ booking.description }}</textarea><br>

                <h3>Existing Images</h3>
                <div id="photo-gallery" class="photo-gallery" data-booking-id="{{ booking.id }}">
                    {% if images %}
                        {% for img in images %}
                            <div class="photo-container" data-image-id="{{ img.id }}">
                                <img class="property-image" src="{{ img.image.url }}" alt="Booking Image" style="width: 200px; height: 150px;">
                                <button type="button" class="delete-photo-btn" data-photo-id="{{ img.id }}">X</button>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>No images uploaded</p>
                    {% endif %}
                </div>
        
                <!-- Upload New Images -->
                <label for="new_images">Upload New Images:</label>
                <input type="file" id="new_images" name="new_images" multiple accept="image/*"><br>
        
                <!-- Action Buttons -->
                <button type="button" class="edit-btn">Edit</button>
                <a href="{% url 'exclusivebookings' %}">
                    <button type="submit" class="save-btn">Save Changes</button>
                </a>
                
            </form>
        
            
            <a href="{% url 'exclusivebookings' %}">
                <button type="button" class="cancel-link-btn">Go Back</button>
            </a>
        </div>
    </div>

        <script>
           document.addEventListener("DOMContentLoaded", function () {
    let isEditing = false;
    const editBtn = document.querySelector(".edit-btn");
    const saveBtn = document.querySelector(".save-btn");
    const cancelBtn = document.querySelector(".cancel-link-btn");
    const form = document.querySelector("form");
    const fields = document.querySelectorAll("input, textarea");
    const redirectUrl = form.dataset.redirect;
    const photoGallery = document.querySelector(".photo-gallery");
    const fileInput = document.getElementById("new_images");
    const csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;
    let originalValues = {};

    // Get booking ID from a data-attribute in the form
    const bookingId = form.dataset.bookingId;

    // Initially, only show the Edit button
    saveBtn.style.display = "none";
    cancelBtn.style.display = "none";

    function toggleEdit() {
        if (!isEditing) {
            isEditing = true;
            fields.forEach(field => {
                field.removeAttribute("readonly");
                originalValues[field.name] = field.value;
            });
            editBtn.style.display = "none";
            saveBtn.style.display = "inline-block";
            cancelBtn.style.display = "inline-block";
        }
    }

    function saveChanges(event) {
        event.preventDefault();
        const formData = new FormData(form);

        fetch(form.action || window.location.href, {  
            method: "POST",
            headers: { "X-CSRFToken": csrfToken },
            body: formData
        })
        .then(response => response.json().catch(() => { throw new Error("Invalid JSON response") }))
        .then(data => {
            if (data.success) {  
                alert("Changes saved successfully!");
                window.location.href = redirectUrl;
            } else {
                alert("Error saving changes.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Saved Successfully");
        });
    }

    function cancelChanges() {
        fields.forEach(field => {
            field.value = originalValues[field.name] || "";
            field.setAttribute("readonly", true);
        });
        isEditing = false;
        editBtn.style.display = "inline-block";
        saveBtn.style.display = "none";
        cancelBtn.style.display = "none";
    }

    function loadExistingPhotos() {
        fetch(`/get-exclusive-images/${bookingId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.images && data.images.length > 0) {
                photoGallery.innerHTML = "";
                data.images.forEach(image => {
                    const div = document.createElement("div");
                    div.classList.add("photo-container");
                    div.dataset.imageId = image.id;
                    div.innerHTML = `
                        <img src="${image.url}" alt="Villa Image" class="existing-image">
                        <button type="button" class="delete-photo-btn" data-photo-id="${image.id}">X</button>
                    `;
                    photoGallery.appendChild(div);
                    div.querySelector(".delete-photo-btn").addEventListener("click", () => deletePhoto(image.id));
                });
            } else {
                photoGallery.innerHTML = "<p>No images uploaded</p>";
            }
        })
        .catch(error => console.error("Error fetching images:", error));
    }

    loadExistingPhotos();

    function uploadPhotos() {
        if (!fileInput.files.length) {
            alert("Please select files to upload");
            return;
        }

        const formData = new FormData();
        for (let file of fileInput.files) {
            formData.append('photos', file);
        }

        fetch(`/upload-exclusive-images/${bookingId}/`, {
            method: "POST",
            headers: { "X-CSRFToken": csrfToken },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadExistingPhotos();
            } else {
                alert("Error uploading photos");
            }
        })
        .catch(error => console.error("Error:", error));
    }

    function deletePhoto(photoId) {
        if (!isEditing) {
            alert('Please click Edit to make changes');
            return;
        }

        if (confirm('Are you sure you want to delete this photo?')) {
            fetch(`/delete-property-photo/${photoId}/`, {
                method: 'POST',
                headers: { 'X-CSRFToken': csrfToken }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.querySelector(`[data-image-id="${photoId}"]`).remove();
                    alert('Photo deleted successfully!');
                } else {
                    alert('Error deleting photo');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting photo');
            });
        }
    }

    document.querySelectorAll('.delete-photo-btn').forEach(button => {
        button.addEventListener('click', function() {
            deletePhoto(this.dataset.photoId);
        });
    });

    editBtn.addEventListener("click", toggleEdit);
    saveBtn.addEventListener("click", saveChanges);
    cancelBtn.addEventListener("click", cancelChanges);
    fileInput.addEventListener("change", uploadPhotos);
});


    </script>
    </body>
</html>
